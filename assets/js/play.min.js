var outerRadius=275,innerRadius=100,textFontSize=16;if($(window).width()<560){$("#canvas").attr("height",$(window).width()-10),$("#canvas").attr("width",$(window).width()-10),outerRadius=$(window).width()/2-10,innerRadius=$(window).width()/6,$(window).width()<450&&(textFontSize=10);var top_btn_spin=outerRadius-innerRadius+5,left_btn_spin=top_btn_spin;$("#spin_button").css({top:top_btn_spin,left:left_btn_spin,width:2*innerRadius,height:2*innerRadius,"padding-top":innerRadius-25})}var dataspin=jQuery.parseJSON($("#spin_button").attr("data-spin")),theWheel=new Winwheel({numSegments:$("#spin_button").attr("num-data"),outerRadius:outerRadius,innerRadius:innerRadius,textFontSize:textFontSize,textMargin:0,segments:dataspin,animation:{type:"spinToStop",duration:5,spins:8,callbackFinished:alertPrize}}),wheelPower=0,wheelSpinning=!1;function startSpin(){0==wheelSpinning?$.ajax({url:"get_radius",type:"post",data:{total:$("#spin_button").attr("num-data")},dataType:"json",success:function(a){a.radius?(theWheel.rotationAngle=0,theWheel.startAnimation(a.radius)):(alert(a.msg),a.open_popup_email&&$("#myModal").modal("show"))},error:function(a){alert("Lỗi! Vui lòng thử lại.")}}):alert("Bạn đã hết lượt quay.")}function alertPrize(){var a=theWheel.getIndicatedSegment();$.ajax({url:"get_name_awards",type:"post",data:{alias:a.text},dataType:"json",success:function(a){console.log(a),1==a.status?("GOOD-LUCK"==a.data.alias?alert(a.data.award):(alert("Bạn đã quay được: "+a.data.award),ajax_send_email_award(a.data.email,a.data.alias)),$("#num-spin .num").html(a.data.spin)):alert(a.msg)},error:function(a){}})}function ajax_send_email_award(a,t){$("#LoadingImage").show(),$.ajax({url:"send_email_award",type:"post",data:{email_to:a,award_alias:t},dataType:"json",success:function(a){$("#LoadingImage").hide(),alert(a.msg)},error:function(a){$("#LoadingImage").hide(),alert("Fail")}})}$(document).ready(function(){$(".btn-save-email").on("click",function(){var a=$(this).closest(".modal-dialog").find("input[name=email]").val();a&&$.ajax({url:"saveUserEmail",type:"post",data:{email:a},dataType:"json",success:function(a){alert(a.msg),1==a.status&&$("#myModal").modal("hide")},error:function(a){}})})});